const hre  = require("hardhat");
const fs   = require("fs");
const path = require("path");

async function main() {
  const [deployer] = await hre.ethers.getSigners();
  const network    = hre.network.name;

  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("  POLITICIAN SURFERS â€” Deploying to", network.toUpperCase());
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("Deployer :", deployer.address);
  const balance = await hre.ethers.provider.getBalance(deployer.address);
  console.log("Balance  :", hre.ethers.formatEther(balance), "MON\n");

  if (parseFloat(hre.ethers.formatEther(balance)) < 0.05) {
    console.error("âŒ Insufficient MON balance! Get testnet MON from https://faucet.monad.xyz");
    process.exit(1);
  }

  // â”€â”€ 1. PoliticianSurfers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("1/3  Deploying PoliticianSurfers...");
  const t0 = Date.now();
  const GameFactory  = await hre.ethers.getContractFactory("PoliticianSurfers");
  const gameContract = await GameFactory.deploy();
  await gameContract.waitForDeployment();
  const gameAddr = await gameContract.getAddress();
  console.log(`     âœ… PoliticianSurfers: ${gameAddr}  (${Date.now() - t0}ms)\n`);

  // â”€â”€ 2. Leaderboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("2/3  Deploying Leaderboard...");
  const t1 = Date.now();
  const LBFactory  = await hre.ethers.getContractFactory("Leaderboard");
  const lbContract = await LBFactory.deploy();
  await lbContract.waitForDeployment();
  const lbAddr = await lbContract.getAddress();
  console.log(`     âœ… Leaderboard: ${lbAddr}  (${Date.now() - t1}ms)\n`);

  // â”€â”€ 3. PoliticianNFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("3/3  Deploying PoliticianNFT...");
  const t2 = Date.now();
  const NFTFactory  = await hre.ethers.getContractFactory("PoliticianNFT");
  const nftContract = await NFTFactory.deploy();
  await nftContract.waitForDeployment();
  const nftAddr = await nftContract.getAddress();
  console.log(`     âœ… PoliticianNFT: ${nftAddr}  (${Date.now() - t2}ms)\n`);

  // â”€â”€ Summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("  ALL 3 CONTRACTS DEPLOYED âœ…");
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("  Game        :", gameAddr);
  console.log("  Leaderboard :", lbAddr);
  console.log("  NFT         :", nftAddr);
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

  // â”€â”€ Write addresses.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const addressesPath = path.join(__dirname, "../src/contracts/addresses.ts");
  fs.writeFileSync(addressesPath, `// Auto-generated by deploy.cjs â€” DO NOT EDIT MANUALLY
// Network: ${network}
// Deployed: ${new Date().toISOString()}

export const CONTRACT_ADDRESSES = {
  GAME_CONTRACT:        "${gameAddr}",
  LEADERBOARD_CONTRACT: "${lbAddr}",
  NFT_CONTRACT:         "${nftAddr}",
} as const;

export const NETWORK_CONFIG = {
  chainId:  10143,
  name:     "Monad Testnet",
  rpcUrl:   "https://testnet-rpc.monad.xyz",
  explorer: "https://testnet.monadexplorer.com",
  currency: "MON",
  faucet:   "https://faucet.monad.xyz",
} as const;
`);

  console.log("  ğŸ“„ addresses.ts written â†’ src/contracts/addresses.ts");
  console.log(`  ğŸ” Explorer: https://testnet.monadexplorer.com/address/${gameAddr}`);
  console.log("  â–¶  Run: npm run dev\n");
}

main().catch((e) => { console.error(e); process.exit(1); });
