const hre = require("hardhat");
const fs  = require("fs");
const path = require("path");

async function main() {
  const [deployer] = await hre.ethers.getSigners();
  const network    = hre.network.name;

  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("  POLITICIAN SURFERS â€” Deploying to", network.toUpperCase());
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("Deployer :", deployer.address);

  const balance = await hre.ethers.provider.getBalance(deployer.address);
  console.log("Balance  :", hre.ethers.formatEther(balance), "MON");
  console.log("");

  // â”€â”€ 1. Deploy PoliticianSurfers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("1/3  Deploying PoliticianSurfers...");
  const t0 = Date.now();
  const GameFactory   = await hre.ethers.getContractFactory("PoliticianSurfers");
  const gameContract  = await GameFactory.deploy();
  await gameContract.waitForDeployment();
  const gameAddr = await gameContract.getAddress();
  console.log("     âœ… PoliticianSurfers deployed:", gameAddr, `(${Date.now() - t0} ms)`);

  // â”€â”€ 2. Deploy Leaderboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("2/3  Deploying Leaderboard...");
  const t1 = Date.now();
  const LBFactory    = await hre.ethers.getContractFactory("Leaderboard");
  const lbContract   = await LBFactory.deploy();
  await lbContract.waitForDeployment();
  const lbAddr = await lbContract.getAddress();
  console.log("     âœ… Leaderboard deployed:", lbAddr, `(${Date.now() - t1} ms)`);

  // â”€â”€ 3. Deploy PoliticianNFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  console.log("3/3  Deploying PoliticianNFT...");
  const t2 = Date.now();
  const NFTFactory   = await hre.ethers.getContractFactory("PoliticianNFT");
  const nftContract  = await NFTFactory.deploy();
  await nftContract.waitForDeployment();
  const nftAddr = await nftContract.getAddress();
  console.log("     âœ… PoliticianNFT deployed:", nftAddr, `(${Date.now() - t2} ms)`);

  console.log("");
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("  ALL CONTRACTS DEPLOYED âœ…");
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log("  Game Contract  :", gameAddr);
  console.log("  Leaderboard    :", lbAddr);
  console.log("  NFT Contract   :", nftAddr);
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

  // â”€â”€ Write addresses file for frontend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const addressesDir  = path.join(__dirname, "../src/contracts");
  if (!fs.existsSync(addressesDir)) fs.mkdirSync(addressesDir, { recursive: true });

  const addressesContent = `// Auto-generated by deploy.js â€” DO NOT EDIT MANUALLY
// Network: ${network}
// Deployed: ${new Date().toISOString()}

export const CONTRACT_ADDRESSES = {
  GAME_CONTRACT:       "${gameAddr}",
  LEADERBOARD_CONTRACT:"${lbAddr}",
  NFT_CONTRACT:        "${nftAddr}",
} as const;

export const NETWORK_CONFIG = {
  chainId:     10143,
  name:        "Monad Testnet",
  rpcUrl:      "https://testnet-rpc.monad.xyz",
  explorer:    "https://testnet.monadexplorer.com",
  currency:    "MON",
  faucet:      "https://faucet.monad.xyz",
} as const;
`;
  fs.writeFileSync(path.join(addressesDir, "addresses.ts"), addressesContent);
  console.log("\n  ðŸ“„ addresses.ts written to src/contracts/addresses.ts");
  console.log("  ðŸ‘‰ Run: npm run dev");
  console.log("  ðŸ‘‰ Open MetaMask â†’ Monad Testnet (Chain ID 10143)");
  console.log("  ðŸ‘‰ Faucet: https://faucet.monad.xyz\n");
}

main().catch((err) => {
  console.error(err);
  process.exitCode = 1;
});
